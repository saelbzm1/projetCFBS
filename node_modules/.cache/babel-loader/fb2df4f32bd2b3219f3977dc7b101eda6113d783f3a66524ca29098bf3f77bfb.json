{"ast":null,"code":"/**\n * Note: This file was copied from mapbox-gl-draw@1.1.1 because it is no longer accessible in later versions of mapbox-gl-draw which are required for security benefits.\n *\n * If this PR gets merged https://github.com/mapbox/mapbox-gl-draw/pull/1100 or mapbox-gl-draw is forked to maplibre-gl-draw we should investigate removing these files and getting the dependencies from mapbox-gl-draw\n */\n\nconst createVertex = require(\"./create_vertex\");\nconst createMidpoint = require(\"./create_midpoint\");\nconst Constants = require(\"./constants\");\nfunction createSupplementaryPoints(geojson) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  let basePath = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  const {\n    type,\n    coordinates\n  } = geojson.geometry;\n  const featureId = geojson.properties && geojson.properties.id;\n  let supplementaryPoints = [];\n  if (type === Constants.geojsonTypes.POINT) {\n    // For points, just create a vertex\n    supplementaryPoints.push(createVertex(featureId, coordinates, basePath, isSelectedPath(basePath)));\n  } else if (type === Constants.geojsonTypes.POLYGON) {\n    // Cycle through a Polygon's rings and\n    // process each line\n    coordinates.forEach((line, lineIndex) => {\n      processLine(line, basePath !== null ? `${basePath}.${lineIndex}` : String(lineIndex));\n    });\n  } else if (type === Constants.geojsonTypes.LINE_STRING) {\n    processLine(coordinates, basePath);\n  } else if (type.indexOf(Constants.geojsonTypes.MULTI_PREFIX) === 0) {\n    processMultiGeometry();\n  }\n  function processLine(line, lineBasePath) {\n    let firstPointString = \"\";\n    let lastVertex = null;\n    line.forEach((point, pointIndex) => {\n      const pointPath = lineBasePath !== undefined && lineBasePath !== null ? `${lineBasePath}.${pointIndex}` : String(pointIndex);\n      const vertex = createVertex(featureId, point, pointPath, isSelectedPath(pointPath));\n\n      // If we're creating midpoints, check if there was a\n      // vertex before this one. If so, add a midpoint\n      // between that vertex and this one.\n      if (options.midpoints && lastVertex) {\n        const midpoint = createMidpoint(featureId, lastVertex, vertex, options.map);\n        if (midpoint) {\n          supplementaryPoints.push(midpoint);\n        }\n      }\n      lastVertex = vertex;\n\n      // A Polygon line's last point is the same as the first point. If we're on the last\n      // point, we want to draw a midpoint before it but not another vertex on it\n      // (since we already a vertex there, from the first point).\n      const stringifiedPoint = JSON.stringify(point);\n      if (firstPointString !== stringifiedPoint) {\n        supplementaryPoints.push(vertex);\n      }\n      if (pointIndex === 0) {\n        firstPointString = stringifiedPoint;\n      }\n    });\n  }\n  function isSelectedPath(path) {\n    if (!options.selectedPaths) return false;\n    return options.selectedPaths.indexOf(path) !== -1;\n  }\n\n  // Split a multi-geometry into constituent\n  // geometries, and accumulate the supplementary points\n  // for each of those constituents\n  function processMultiGeometry() {\n    const subType = type.replace(Constants.geojsonTypes.MULTI_PREFIX, \"\");\n    coordinates.forEach((subCoordinates, index) => {\n      const subFeature = {\n        type: Constants.geojsonTypes.FEATURE,\n        properties: geojson.properties,\n        geometry: {\n          type: subType,\n          coordinates: subCoordinates\n        }\n      };\n      supplementaryPoints = supplementaryPoints.concat(createSupplementaryPoints(subFeature, options, index));\n    });\n  }\n  return supplementaryPoints;\n}\nmodule.exports = createSupplementaryPoints;","map":{"version":3,"names":["createVertex","require","createMidpoint","Constants","createSupplementaryPoints","geojson","options","arguments","length","undefined","basePath","type","coordinates","geometry","featureId","properties","id","supplementaryPoints","geojsonTypes","POINT","push","isSelectedPath","POLYGON","forEach","line","lineIndex","processLine","String","LINE_STRING","indexOf","MULTI_PREFIX","processMultiGeometry","lineBasePath","firstPointString","lastVertex","point","pointIndex","pointPath","vertex","midpoints","midpoint","map","stringifiedPoint","JSON","stringify","path","selectedPaths","subType","replace","subCoordinates","index","subFeature","FEATURE","concat","module","exports"],"sources":["C:/Users/sael.bouzemarene/cfbsprojet/node_modules/maplibre-gl-draw-circle/lib/utils/create_supplementary_points.js"],"sourcesContent":["/**\n * Note: This file was copied from mapbox-gl-draw@1.1.1 because it is no longer accessible in later versions of mapbox-gl-draw which are required for security benefits.\n *\n * If this PR gets merged https://github.com/mapbox/mapbox-gl-draw/pull/1100 or mapbox-gl-draw is forked to maplibre-gl-draw we should investigate removing these files and getting the dependencies from mapbox-gl-draw\n */\n\nconst createVertex = require(\"./create_vertex\");\nconst createMidpoint = require(\"./create_midpoint\");\nconst Constants = require(\"./constants\");\n\nfunction createSupplementaryPoints(geojson, options = {}, basePath = null) {\n  const { type, coordinates } = geojson.geometry;\n  const featureId = geojson.properties && geojson.properties.id;\n\n  let supplementaryPoints = [];\n\n  if (type === Constants.geojsonTypes.POINT) {\n    // For points, just create a vertex\n    supplementaryPoints.push(createVertex(featureId, coordinates, basePath, isSelectedPath(basePath)));\n  } else if (type === Constants.geojsonTypes.POLYGON) {\n    // Cycle through a Polygon's rings and\n    // process each line\n    coordinates.forEach((line, lineIndex) => {\n      processLine(line, basePath !== null ? `${basePath}.${lineIndex}` : String(lineIndex));\n    });\n  } else if (type === Constants.geojsonTypes.LINE_STRING) {\n    processLine(coordinates, basePath);\n  } else if (type.indexOf(Constants.geojsonTypes.MULTI_PREFIX) === 0) {\n    processMultiGeometry();\n  }\n\n  function processLine(line, lineBasePath) {\n    let firstPointString = \"\";\n    let lastVertex = null;\n    line.forEach((point, pointIndex) => {\n      const pointPath = lineBasePath !== undefined && lineBasePath !== null ? `${lineBasePath}.${pointIndex}` : String(pointIndex);\n      const vertex = createVertex(featureId, point, pointPath, isSelectedPath(pointPath));\n\n      // If we're creating midpoints, check if there was a\n      // vertex before this one. If so, add a midpoint\n      // between that vertex and this one.\n      if (options.midpoints && lastVertex) {\n        const midpoint = createMidpoint(featureId, lastVertex, vertex, options.map);\n        if (midpoint) {\n          supplementaryPoints.push(midpoint);\n        }\n      }\n      lastVertex = vertex;\n\n      // A Polygon line's last point is the same as the first point. If we're on the last\n      // point, we want to draw a midpoint before it but not another vertex on it\n      // (since we already a vertex there, from the first point).\n      const stringifiedPoint = JSON.stringify(point);\n      if (firstPointString !== stringifiedPoint) {\n        supplementaryPoints.push(vertex);\n      }\n      if (pointIndex === 0) {\n        firstPointString = stringifiedPoint;\n      }\n    });\n  }\n\n  function isSelectedPath(path) {\n    if (!options.selectedPaths) return false;\n    return options.selectedPaths.indexOf(path) !== -1;\n  }\n\n  // Split a multi-geometry into constituent\n  // geometries, and accumulate the supplementary points\n  // for each of those constituents\n  function processMultiGeometry() {\n    const subType = type.replace(Constants.geojsonTypes.MULTI_PREFIX, \"\");\n    coordinates.forEach((subCoordinates, index) => {\n      const subFeature = {\n        type: Constants.geojsonTypes.FEATURE,\n        properties: geojson.properties,\n        geometry: {\n          type: subType,\n          coordinates: subCoordinates,\n        },\n      };\n      supplementaryPoints = supplementaryPoints.concat(createSupplementaryPoints(subFeature, options, index));\n    });\n  }\n\n  return supplementaryPoints;\n}\n\nmodule.exports = createSupplementaryPoints;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}